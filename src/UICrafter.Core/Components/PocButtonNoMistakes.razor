@using MudBlazor
@using UICrafter.Core.Models
@using System.Diagnostics
@using Microsoft.AspNetCore.Components
@using System.Net.Http
@using System.Net.Http.Json
@using UICrafter.Core.Utility

@inject HttpClient Http

@using UICrafter.Core.UIComponents

<MudButton OnClick="CallApi"
           Color="@buttonColor"
           Disabled="@isDisabled">
    @Button.Button.Label
</MudButton>

@code {
    [Parameter]
    public required UIComponent Button { get; set; }

    [CascadingParameter]
    public required StupidStore StupidStore { get; set; }

    private bool isDisabled = false;
    private Color buttonColor = Color.Primary;

    private async Task CallApi()
    {
        try
        {
            isDisabled = true;
            var originalLabel = Button.Button.Label;
            Button.Button.Label = "Loading...";

            // Assume that Button.URL is the API endpoint
            var response = await Http.GetStringAsync(Button.Button.URL);

            if (response == null)
            {
                // Handle null response
                buttonColor = Color.Error;
                return;
            }

            await Task.Delay(1000);
            Button.Button.Label = originalLabel;
            buttonColor = Color.Success;
            isDisabled = false;

            // Notify subscribers
            StupidStore.NotifySubscribers(Button.Guid, response);
        }
        catch (Exception ex)
        {
            Debug.WriteLine($"Error calling API for button {Button.Button.Label}: {ex.Message}");
        }
    }
}

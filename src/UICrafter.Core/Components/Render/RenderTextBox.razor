@inherits BaseTextBox

@{
    base.BuildRenderTree(__builder);
}

@code {
    [Parameter]
    public required UIComponent Textbox { get; set; }

    protected override void OnParametersSet()
    {
        base.OnParametersSet();

        Label = Textbox.Textbox.Label;
        Lines = Textbox.Textbox.NumberOfLines;
    }

    protected override void OnInitialized()
    {
        base.OnInitialized();

        Textbox.Textbox.UpdateContent = UpdateTextboxContent;
    }

    private void UpdateTextboxContent(Dictionary<string, object> jsonResponse)
    {
        if (string.IsNullOrEmpty(Textbox.Textbox.JsonField))
        {
            Content = "No JsonField specified.";
        }
        else
        {
            string field = Textbox.Textbox.JsonField;
            if (JsonToString.TryGetNestedFieldValue(jsonResponse, field, out var fieldValue))
            {
                string description = JsonToString.ObjectAsString(fieldValue);
                Content = JsonToString.CleanUpString(description);
            }
            else
            {
                Content = $"Field '{Textbox.Textbox.JsonField}' not found in JSON response.";
            }
        }

        InvokeAsync(StateHasChanged);
    }
}
